<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.haoze.admin.mapper.FastMenuMapper">


    <insert id="insertFastMenu" parameterType="com.haoze.admin.model.FastMenuEntity">
        insert into t_fast_menu (TFM_ID, DATA_VERSION, GMT_CREATE, GMT_MODIFY, TU_ID, TM_ID,FAST_MENU_NAME,FAST_MENU_SORT)
        values (#{tfmId,jdbcType=VARCHAR}, #{dataVersion,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP},
        #{modifyTime,jdbcType=TIMESTAMP},#{tuId,jdbcType=VARCHAR}, #{tmId,jdbcType=VARCHAR}, #{fastMenuName,jdbcType=VARCHAR}, #{fastMenuSort,jdbcType=VARCHAR})
    </insert>

    <update id="updateFastMenu" parameterType="com.haoze.admin.model.FastMenuEntity">
        update t_fast_menu set GMT_MODIFY=#{modifyTime},FAST_MENU_SORT=#{fastMenuSort},FAST_MENU_NAME=#{fastMenuName},TM_ID=#{tmId}
        where TFM_ID = #{tfmId}
    </update>

    <update id="updateSortNoForEnlarge" parameterType="String">
        update t_fast_menu set FAST_MENU_SORT=FAST_MENU_SORT+1 where FAST_MENU_SORT &gt;= #{fastMenuSort}
    </update>

    <update id="updateSortNoForReduce" parameterType="java.util.Map">
        update t_fast_menu set FAST_MENU_SORT=FAST_MENU_SORT-1 where FAST_MENU_SORT &gt;= #{fastMenuSort}
    </update>

    <select id="selectMenuByUserRole" parameterType="String" resultType="com.haoze.admin.model.MenuEntity">
        select m.TM_ID "tmId", m.GMT_CREATE "createTime", m.GMT_MODIFY "modifyTime", m.MENU_CODE "menuCode", m.MENU_NAME
        "menuName",
        m.PARENT_MENU_ID "parentMenuId", m.MENU_SORT "menuSort", m.PY_CODE "pyCode", m.WB_CODE "wbCode", m.MENU_URL "menuUrl",
        m.MODEL_TYPE_FLAG "modelTypeFlag", m.MENU_PERMISSION "menuPermission" from t_user u
        left join t_user_role ug on ug.tu_id = u.tu_id
        left join t_role_menu gm on gm.tr_id = ug.tr_id
        left join t_menu m on m.tm_id = gm.tm_id
        where u.LOGIN_NAME = #{account,jdbcType=VARCHAR}
        and DISPLAY_FLAG = 0 and MODEL_TYPE_FLAG in ('1','2')
        ORDER BY MENU_SORT
    </select>

    <select id="countMenuRoleByMenuId" parameterType="String" resultType="int">
        select count(1) from t_role_menu where TM_ID=#{menuId,jdbcType=VARCHAR}
    </select>

    <select id="list" parameterType="String" resultType="com.haoze.admin.dto.system.FastMenuDTO">
        select
        tfm.FAST_MENU_NAME fastMenuName,
        tfm.TFM_ID tfmId,
        tfm.CLICK_NUM clickNum,
        tfm.FAST_MENU_SORT fastMenuSort,
        tfm.REMARK remark,
        tfm.GMT_CREATE createTime,
        tfm.GMT_MODIFY modifyTime,
        tfm.DATA_VERSION dataVersion,
        tm.MENU_URL menuUrl
        from t_fast_menu tfm
        inner join t_menu tm on tfm.TM_ID = tm.TM_ID
        where tfm.TU_ID = #{id}
        order by tfm.FAST_MENU_SORT asc,tfm.CLICK_NUM desc
    </select>
</mapper>